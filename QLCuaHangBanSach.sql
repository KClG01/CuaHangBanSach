USE [master]
CREATE DATABASE QLCuaHangBanSach
GO

USE [QLCuaHangBanSach]
GO

-- TẠO BẢNG KHÁCH HÀNG
CREATE TABLE KHACH_HANG
(
	MAKH CHAR(5),
	TENKH NVARCHAR(256),
	SDT CHAR(12), 
	EMAIL CHAR(20),
	DIACHI NVARCHAR(256),
	NGAYTAO DATE DEFAULT(GETDATE()),
	TRANGTHAI INT,
	CONSTRAINT PK_KHACHHANG PRIMARY KEY(MAKH),
	CONSTRAINT UN_KHACHHANG_SDT UNIQUE(SDT,EMAIL),
)
-- TẠO BẢNG SẢN PHẨM
CREATE TABLE SAN_PHAM
(
	MASP INT,
	TENSP CHAR(256),
	MA_TACGIA CHAR(5),
	MA_NXB CHAR(5),
	MA_LOAI INT,
	GIANHAP MONEY,
	GIABAN MONEY,
	SLTON INT,
	HINHANH VARCHAR(256),
	TRANGTHAI BIT,
	CONSTRAINT PK_SANPHAM PRIMARY KEY(MASP),
	CONSTRAINT CK_SANPHAM_GIABAN CHECK(GIABAN >0),
	CONSTRAINT UN_SANPHAM_TENSP UNIQUE(TENSP)
)
-- TẠO BẢNG HÓA ĐƠN
CREATE TABLE HOA_DON
(
	MAHD INT IDENTITY(1,1),
	MANV CHAR(5),
	MAKH CHAR(5),
	NGAYBAN DATETIME DEFAULT GETDATE(),
	TIENNHAN MONEY,
	TIENTRA MONEY,
	THANHTIEN MONEY,
	CONSTRAINT PK_HOADON PRIMARY KEY(MAHD),
	CONSTRAINT FK_HOADON_KHACHHANG FOREIGN KEY (MAKH) REFERENCES KHACH_HANG(MAKH)
)
-- TẠO BẢNG NHÂN VIÊN
CREATE TABLE NHAN_VIEN
(
	MA_NV CHAR(5),
	TEN_NV NVARCHAR(256),
	MA_NQL CHAR(5),
	GIOITINH Bit,
	SDT CHAR(12),
	EMAIL CHAR(20),
	DIACHI NVARCHAR(256),
	LUONG MONEY,
	NGAYTAO DATE DEFAULT GETDATE(),
	TRANGTHAI BIT,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY (MA_NV),
	CONSTRAINT FK_NHANVIEN_QL FOREIGN KEY (MA_NQL) REFERENCES  NHAN_VIEN(MA_NV)
)
-- TẠO BẢNG CHI TIẾT HÓA ĐƠN
CREATE TABLE CT_HOADON
(
	MAHD INT,
	MASP INT,
	SOLUONG INT,
	DONGIA MONEY,
	KHUYENMAI FLOAT,
	THANHTIEN MONEY,
	CONSTRAINT PK_CTHOADON PRIMARY KEY (MAHD,MASP),
	CONSTRAINT CK_CT_KHUYENMAI CHECK(KHUYENMAI > 0),
)
-- TẠO BẢNG SẢN PHẨM
CREATE TABLE LOAI_SP
(
	MA_LOAI INT,
	TENLOAI NVARCHAR(30),
	CONSTRAINT FK_LOAISP PRIMARY KEY (MA_LOAI)
)
-- TẠO BẢNG NHÀ XUẤT BẢN
CREATE TABLE NHA_XUAT_BAN
	(
	MA_NXB CHAR(5),
	TEN_NXB NVARCHAR(50),
	LIENHE CHAR(12),
	DIACHI NVARCHAR(256)
	CONSTRAINT PK_MANXB PRIMARY KEY(MA_NXB)
)
-- TẠO BẢNG TÁC GIẢ
CREATE TABLE TAC_GIA
(
	MA_TC CHAR(5),
	BUTDANH NVARCHAR(50),
	TEN_TC NVARCHAR(50),
	NGSINH CHAR(10),
	LIENHE CHAR(12),
	DIACHI NVARCHAR(256) 

	CONSTRAINT PK_MATC PRIMARY KEY(MA_TC)
)

-- ALTER TABLE

ALTER TABLE HOA_DON
	ADD CONSTRAINT FK_HOADON_NHANVIEN
	FOREIGN KEY (MANV) REFERENCES NHAN_VIEN(MA_NV)


ALTER TABLE CT_HOADON
	ADD CONSTRAINT FK_CT_HOADON
	FOREIGN KEY (MAHD) REFERENCES HOA_DON(MAHD)

ALTER TABLE CT_HOADON
	ADD CONSTRAINT FK_CT_SANPHAM
	FOREIGN KEY (MASP) REFERENCES SAN_PHAM(MASP)

ALTER TABLE SAN_PHAM
	ADD CONSTRAINT FK_SANPHAM_LOAISP
	FOREIGN KEY (MA_LOAI) REFERENCES LOAI_SP(MA_LOAI)

ALTER TABLE SAN_PHAM
	ADD CONSTRAINT FK_SP_NXB
	FOREIGN KEY(MA_NXB) REFERENCES NHA_XUAT_BAN(MA_NXB)

ALTER TABLE SAN_PHAM
	ADD CONSTRAINT FK_SP_TC
	FOREIGN KEY(MA_TACGIA) REFERENCES TAC_GIA(MA_TC)

ALTER TABLE NHAN_VIEN
ADD PASSWORD CHAR(20);

-- INSERT
-- Chèn dữ liệu vào bảng KHACH_HANG
INSERT INTO KHACH_HANG (MAKH, TENKH, SDT, EMAIL, DIACHI, TRANGTHAI)
VALUES 
('KH001', 'Nguyễn Văn A', '0123456789', 'a@gmail.com', '123 Đường ABC, Quận 1', 1),
('KH002', 'Trần Thị B', '0987654321', 'b@gmail.com', '456 Đường DEF, Quận 2', 1),
('KH003', 'Lê Văn C', '0123456780', 'c@gmail.com', '789 Đường GHI, Quận 3', 1),
('KH004', 'Phạm Thị D', '0987654322', 'd@gmail.com', '321 Đường JKL, Quận 4', 1),
('KH005', 'Nguyễn Văn E', '0123456781', 'e@gmail.com', '654 Đường MNO, Quận 5', 1),
('KH006', 'Trần Thị F', '0987654323', 'f@gmail.com', '987 Đường PQR, Quận 6', 1),
('KH007', 'Lê Văn G', '0123456782', 'g@gmail.com', '159 Đường STU, Quận 7', 1),
('KH008', 'Phạm Thị H', '0987654324', 'h@gmail.com', '753 Đường VWX, Quận 8', 1),
('KH009', 'Nguyễn Văn I', '0123456783', 'i@gmail.com', '852 Đường YZ, Quận 9', 1),
('KH010', 'Trần Thị J', '0987654325', 'j@gmail.com', '963 Đường AB, Quận 10', 1);

-- Chèn dữ liệu vào bảng LOAI_SP
INSERT INTO LOAI_SP (MA_LOAI, TENLOAI)
VALUES 
(1, 'Sách Tiếng Việt'),
(2, 'Sách Ngoại Văn'),
(3, 'Sách Thiếu Nhi'),
(4, 'Sách Khoa Học'),
(5, 'Sách Văn Học'),
(6, 'Sách Lịch Sử'),
(7, 'Sách Du Lịch'),
(8, 'Sách Tâm Lý'),
(9, 'Sách Nghệ Thuật'),
(10, 'Sách Kỹ Năng Sống');

-- Chèn dữ liệu vào bảng NHA_XUAT_BAN
INSERT INTO NHA_XUAT_BAN (MA_NXB, TEN_NXB, LIENHE, DIACHI)
VALUES 
('NXB01', 'Nhà Xuất Bản A', '0123456789', '789 Đường GHI, Quận 3'),
('NXB02', 'Nhà Xuất Bản B', '0987654321', '321 Đường JKL, Quận 4'),
('NXB03', 'Nhà Xuất Bản C', '0123456782', '654 Đường MNO, Quận 5'),
('NXB04', 'Nhà Xuất Bản D', '0987654323', '987 Đường PQR, Quận 6'),
('NXB05', 'Nhà Xuất Bản E', '0123456784', '159 Đường STU, Quận 7'),
('NXB06', 'Nhà Xuất Bản F', '0987654325', '753 Đường VWX, Quận 8'),
('NXB07', 'Nhà Xuất Bản G', '0123456786', '852 Đường YZ, Quận 9'),
('NXB08', 'Nhà Xuất Bản H', '0987654327', '963 Đường AB, Quận 10'),
('NXB09', 'Nhà Xuất Bản I', '0123456788', '147 Đường CD, Quận 11'),
('NXB10', 'Nhà Xuất Bản J', '0987654329', '258 Đường EF, Quận 12');

-- Chèn dữ liệu vào bảng TAC_GIA
INSERT INTO TAC_GIA (MA_TC, BUTDANH, TEN_TC, NGSINH, LIENHE, DIACHI)
VALUES 
('TC001', 'Tác Giả A', 'Nguyễn Văn A', '01/01/1980', '0123456789', 'Địa chỉ A'),
('TC002', 'Tác Giả B', 'Trần Thị B', '02/02/1990', '0987654321', 'Địa chỉ B'),
('TC003', 'Tác Giả C', 'Lê Văn C', '03/03/1985', '0123456782', 'Địa chỉ C'),
('TC004', 'Tác Giả D', 'Phạm Thị D', '04/04/1995', '0987654323', 'Địa chỉ D'),
('TC005', 'Tác Giả E', 'Nguyễn Văn E', '05/05/1982', '0123456784', 'Địa chỉ E'),
('TC006', 'Tác Giả F', 'Trần Thị F', '06/06/1990', '0987654325', 'Địa chỉ F'),
('TC007', 'Tác Giả G', 'Lê Văn G', '07/07/1988', '0123456786', 'Địa chỉ G'),
('TC008', 'Tác Giả H', 'Phạm Thị H', '08/08/1993', '0987654327', 'Địa chỉ H'),
('TC009', 'Tác Giả I', 'Nguyễn Văn I', '09/09/1987', '0123456788', 'Địa chỉ I'),
('TC010', 'Tác Giả J', 'Trần Thị J', '10/10/1992', '0987654329', 'Địa chỉ J');

-- Chèn dữ liệu vào bảng SAN_PHAM
INSERT INTO SAN_PHAM (MASP, TENSP, MA_TACGIA, MA_NXB, MA_LOAI, GIANHAP, GIABAN, SLTON, HINHANH, TRANGTHAI)
VALUES 
(1, 'Sách A', 'TC001', 'NXB01', 1, 10000, 15000, 100, '', 1),
(2, 'Sách B', 'TC002', 'NXB02', 2, 20000, 25000, 50, '', 1),
(3, 'Sách C', 'TC003', 'NXB03', 3, 30000, 35000, 75, '', 1),
(4, 'Sách D', 'TC004', 'NXB04', 4, 15000, 20000, 60, '', 1),
(5, 'Sách E', 'TC005', 'NXB05', 5, 50000, 60000, 30, '', 1),
(6, 'Sách F', 'TC006', 'NXB06', 6, 25000, 30000, 40, '', 1),
(7, 'Sách G', 'TC007', 'NXB07', 7, 35000, 40000, 20, '', 1),
(8, 'Sách H', 'TC008', 'NXB08', 8, 45000, 50000, 15, 's', 1),
(9, 'Sách I', 'TC009', 'NXB09', 9, 60000, 70000, 10, '', 1),
(10, 'Sách J', 'TC010', 'NXB10', 10, 55000, 65000, 5, '', 1);

-- Chèn dữ liệu vào bảng NHAN_VIEN
INSERT INTO NHAN_VIEN (MA_NV, TEN_NV, MA_NQL, GIOITINH, SDT, EMAIL, DIACHI, LUONG, TRANGTHAI)
VALUES 
('NV001', 'Nguyễn Văn C', NULL, 1, '0123456789', 'c@gmail.com', '456 Đường MNO, Quận 5', 5000000, 1),
('NV002', 'Trần Thị D', 'NV001', 0, '0987654321', 'd@gmail.com', '789 Đường PQR, Quận 6', 6000000, 1),
('NV003', 'Lê Văn E', 'NV001', 1, '0123456782', 'e@gmail.com', '321 Đường STU, Quận 7', 5500000, 1),
('NV004', 'Phạm Thị F', 'NV001', 0, '0987654323', 'f@gmail.com', '654 Đường VWX, Quận 8', 5800000, 1),
('NV005', 'Nguyễn Văn G', 'NV002', 1, '0123456784', 'g@gmail.com', '852 Đường YZ, Quận 9', 6200000, 1),
('NV006', 'Trần Thị H', 'NV002', 0, '0987654325', 'h@gmail.com', '963 Đường AB, Quận 10', 6400000, 1),
('NV007', 'Lê Văn I', 'NV002', 1, '0123456786', 'i@gmail.com', '147 Đường CD, Quận 11', 6700000, 1),
('NV008', 'Phạm Thị J', 'NV002', 0, '0987654327', 'j@gmail.com', '258 Đường EF, Quận 12', 6900000, 1),
('NV009', 'Nguyễn Văn K', 'NV003', 1, '0123456788', 'k@gmail.com', '369 Đường GH, Quận 13', 7100000, 1),
('NV010', 'Trần Thị L', 'NV003', 0, '0987654329', 'l@gmail.com', '741 Đường IJ, Quận 14', 7300000, 1);

-- Chèn dữ liệu vào bảng HOA_DON
INSERT INTO HOA_DON (MANV, MAKH, TIENNHAN, TIENTRA, THANHTIEN)
VALUES 
('NV001', 'KH001', 20000, 0, 15000),
('NV002', 'KH002', 30000, 5000, 25000),
('NV003', 'KH003', 40000, 10000, 35000),
('NV004', 'KH004', 50000, 15000, 45000),
('NV001', 'KH005', 60000, 20000, 55000),
('NV002', 'KH006', 70000, 25000, 65000),
('NV003', 'KH007', 80000, 30000, 75000),
('NV004', 'KH008', 90000, 35000, 85000),
('NV001', 'KH009', 100000, 40000, 95000),
('NV002', 'KH010', 110000, 45000, 105000);

-- Chèn dữ liệu vào bảng CT_HOADON
INSERT INTO CT_HOADON (MAHD, MASP, SOLUONG, DONGIA, KHUYENMAI, THANHTIEN)
VALUES 
(1, 1, 1, 15000, 0.1, 15000),
(1, 2, 1, 25000, 0.1, 25000),
(2, 3, 1, 35000, 0.1, 35000),
(2, 4, 1, 20000, 0.1, 20000),
(3, 5, 1, 60000, 0.1, 60000),
(3, 6, 1, 30000, 0.1, 30000),
(4, 7, 1, 40000, 0.1, 40000),
(4, 8, 1, 50000, 0.1, 50000),
(5, 9, 1, 70000, 0.1, 70000),
(5, 10, 1, 65000, 0.1, 65000);